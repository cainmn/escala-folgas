
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Escala de Folgas</title>
<style>
  :root{
    --bg:#eef1f5; --card:#fff; --text:#222; --muted:#666;
    --accent:#007bff; --ok:#4caf50; --warn:#ff9800; --danger:#d9534f;
  }
  .dark{ --bg:#121212; --card:#1b1b1b; --text:#e6e6e6; --muted:#aaa; --accent:#5aa9ff; }
  body { font-family: Arial, sans-serif; background:var(--bg); color:var(--text); margin:0; padding:20px; }
  h2 { text-align:center; margin-bottom:12px; }
  .controls { display:flex; justify-content:center; gap:8px; flex-wrap:wrap; margin-bottom:16px; }
  select, button { padding:10px; font-size:14px; border-radius:8px; border:1px solid #bbb; cursor:pointer; background:var(--card); color:var(--text); }
  button.primary { background:var(--accent); color:white; border:none; }
  button.green { background:var(--ok); color:white; border:none; }
  button.orange { background:var(--warn); color:white; border:none; }
  button.red { background:var(--danger); color:white; border:none; }
  .pessoa { background:var(--card); padding:14px; margin-bottom:16px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
  .em-folga { background:#c4f7c4 !important; border-left:6px solid #aa1f1f; }
  .entra-hoje { background:#ffd2d2 !important; border-left:6px solid #f0d24c; }
  .titulo { font-size:18px; font-weight:700; margin-bottom:8px; }
  .folga-item { padding:6px 0; }
  .data { font-weight:700; color:var(--text); }
  .hora { color:var(--muted); }
  hr { border:none; border-bottom:1px solid rgba(0,0,0,0.08); margin:8px 0; }
  /* login modal */
  .modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.4); z-index:9999; }
  .card { background:var(--card); padding:18px; border-radius:12px; width:320px; box-shadow:0 8px 30px rgba(0,0,0,0.3); color:var(--text); }
  input[type="email"], input[type="password"]{ width:100%; padding:8px; margin:6px 0 12px; border-radius:6px; border:1px solid #ccc; background:transparent; color:var(--text); }
  .topbar { display:flex; gap:8px; justify-content:flex-end; align-items:center; margin-bottom:12px; }
  .small { font-size:13px; color:var(--muted); }
</style>
</head>
<body>

<div class="topbar" style="position:sticky;top:0;background:transparent;padding-bottom:8px;z-index:5;">
  <label style="display:flex;align-items:center;gap:8px;">
    <input type="checkbox" id="darkToggle"> Modo escuro
  </label>
  <button id="loginBtn" class="primary">Login</button>
  <button id="logoutBtn" style="display:none">Logout</button>
</div>

<h2>Escala de Folgas</h2>

<div class="controls">
    <select id="funcSelect"><option value="todos">Todos Funcion√°rios</option></select>

    <select id="mesSelect">
        <option value="todos">Todos os meses</option>
    </select>

    <button class="primary" onclick="mostrarFolgasAgora()">Quem est√° de folga agora?</button>
    <button class="small" onclick="carregarFolgasDoBanco()">Carregar da Nuvem</button>
    <button class="small" onclick="salvarTodasNoBanco()">Salvar na Nuvem</button>
</div>

<div id="lista"></div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<!-- LOGIN MODAL -->
<div id="loginModal" class="modal" style="display:none;">
  <div class="card">
    <h3>Entrar</h3>
    <div class="small">Use o usu√°rio do Supabase (email e senha).</div>
    <input id="loginEmail" type="email" placeholder="Email" />
    <input id="loginPass" type="password" placeholder="Senha" />
    <label><input id="rememberMe" type="checkbox" /> Lembrar de mim</label>
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button class="primary" onclick="doLogin()">Entrar</button>
      <button onclick="closeLogin()">Fechar</button>
    </div>
    <div id="loginMsg" class="small" style="margin-top:8px;color:crimson;"></div>
  </div>
</div>

<script>
/* ---------------- CONFIG SUPABASE ---------------- */
const SUPABASE_URL = "https://gaqazvekgpvecuhfuiel.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdhcWF6dmVrZ3B2ZWN1aGZ1aWVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MDc1NDQsImV4cCI6MjA4MDQ4MzU0NH0.crmOSloZVI0CMuJkIBLfOI6yKiT8dmEa10xrQnFBIcM"; // j√° configurada por vc no Supabase (anon public) -> mantenha segura
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ---------------- HELPERS ---------------- */
function pad2(n){ return n.toString().padStart(2,"0"); }
function parseDateTime(str){
  // espera "YYYY-MM-DD HH:MM" ‚Äî se recebemos ISO passa por Date
  if(!str) return new Date(0);
  if(str.includes("T") || str.includes("Z")) {
    const d = new Date(str);
    return new Date(d.getFullYear(), d.getMonth(), d.getDate(), d.getHours(), d.getMinutes());
  }
  const [d,t] = String(str).split(" ");
  const [Y,M,D] = d.split("-").map(Number);
  const [h,m] = (t||"00:00").split(":").map(Number);
  return new Date(Y, M-1, D, h, m);
}
function formatDateTime(dt){ return `${dt.getFullYear()}-${pad2(dt.getMonth()+1)}-${pad2(dt.getDate())} ${pad2(dt.getHours())}:${pad2(dt.getMinutes())}`; }
function formatDateInput(dt){ return `${dt.getFullYear()}-${pad2(dt.getMonth()+1)}-${pad2(dt.getDate())}`; }
function formatTimeInput(dt){ return `${pad2(dt.getHours())}:${pad2(dt.getMinutes())}`; }

/* ---------------- DADOS INICIAIS (DEZ/2025) - caso banco vazio ---------------- */
const folgas = [
  { nome:"Anderson Saraiva Serrano", editando:false, periodos:[
    ["2025-12-02 07:00","2025-12-03 19:00"],
    ["2025-12-10 19:00","2025-12-12 07:00"],
    ["2025-12-19 07:00","2025-12-20 19:00"],
    ["2025-12-27 19:00","2025-12-29 07:00"],
    ["2025-12-30 07:00","2025-12-31 19:00"]
  ]},
  { nome:"Henrique", editando:false, periodos:[
    ["2025-12-03 19:00","2025-12-05 07:00"],
    ["2025-12-12 07:00","2025-12-13 19:00"],
    ["2025-12-20 19:00","2025-12-22 07:00"],
    ["2025-12-23 07:00","2025-12-24 19:00"],
    ["2025-12-31 19:00","2026-01-02 07:00"]
  ]},
  { nome:"Jo√£o", editando:false, periodos:[
    ["2025-12-05 07:00","2025-12-06 19:00"],
    ["2025-12-13 19:00","2025-12-15 07:00"],
    ["2025-12-16 07:00","2025-12-17 19:00"],
    ["2025-12-24 19:00","2025-12-26 07:00"]
  ]},
  { nome:"Rafael", editando:false, periodos:[
    ["2025-12-06 19:00","2025-12-08 07:00"],
    ["2025-12-09 07:00","2025-12-10 19:00"],
    ["2025-12-17 19:00","2025-12-19 07:00"],
    ["2025-12-26 07:00","2025-12-27 19:00"]
  ]},
  { nome:"Vanderlei", editando:false, periodos:[]}
];
folgas[4].periodos = JSON.parse(JSON.stringify(folgas[3].periodos));

/* ---------------- POPULAR FUNCION√ÅRIOS ---------------- */
function popularFuncionarios(){
  const sel = document.getElementById("funcSelect");
  sel.innerHTML = '<option value="todos">Todos Funcion√°rios</option>';
  folgas.forEach(f => {
    const o = document.createElement("option");
    o.value = f.nome; o.textContent = f.nome; sel.appendChild(o);
  });
}

/* ---------------- GERAR MESES (a partir de 2025-12 ou m√™s atual, o que for maior) ---------------- */
function gerarMesesNoSelect(){
  const sel = document.getElementById("mesSelect");
  sel.innerHTML = '<option value="todos">Todos os meses</option>';
  const hoje = new Date();
  const primeiroAno = 2025, primeiroMes = 12; // n√£o mostrar meses ANTES de 2025-12
  const start = new Date(Math.max(new Date(primeiroAno, primeiroMes-1,1).getTime(), new Date(hoje.getFullYear(), hoje.getMonth(),1).getTime()));
  const anoStart = start.getFullYear(), mesStart = start.getMonth()+1;
  for(let ano=anoStart; ano<=2026; ano++){
    for(let mes = (ano===anoStart?mesStart:1); mes<=12; mes++){
      const v = `${ano}-${pad2(mes)}`;
      const nome = new Date(ano, mes-1,1).toLocaleDateString("pt-BR",{month:"long"});
      const opt = document.createElement("option"); opt.value = v; opt.textContent = `${nome} ${ano}`; sel.appendChild(opt);
    }
  }
  // selecionar m√™s atual se poss√≠vel
  const atual = `${(new Date()).getFullYear()}-${pad2((new Date()).getMonth()+1)}`;
  // se atual for anterior a 2025-12, selecionar 2025-12
  const min = `2025-12`;
  sel.value = (atual < min ? min : atual);
}

/* ---------------- GERAR FOLGAS AT√â 2026 (se precisar) ---------------- */
function gerarFolgasAte2026(){
  const limite = new Date(2026,11,31,23,59);
  folgas.forEach(pessoa => {
    if(!pessoa.periodos || pessoa.periodos.length===0) return;
    let ultFim = parseDateTime(pessoa.periodos[pessoa.periodos.length-1][1]);
    while(true){
      let inicio;
      if(ultFim.getDay() === 1){
        inicio = new Date(ultFim); inicio.setDate(inicio.getDate()+1); inicio.setHours(7,0,0,0);
      } else {
        inicio = new Date(ultFim.getTime() + 7*24*60*60*1000);
        if(inicio.getDay() === 1){ inicio.setDate(inicio.getDate()+1); inicio.setHours(7,0,0,0); }
      }
      if(inicio > limite) break;
      const fim = new Date(inicio.getTime() + 36*60*60*1000);
      pessoa.periodos.push([ formatDateTime(inicio), formatDateTime(fim) ]);
      ultFim = fim;
    }
  });
  // garantir Rafael = Vanderlei
  const r = folgas.find(x=>x.nome==="Rafael"), v = folgas.find(x=>x.nome==="Vanderlei");
  if(r && v) v.periodos = JSON.parse(JSON.stringify(r.periodos));
}

/* ---------------- ESTA DE FOLGA ---------------- */
function estaDeFolga(periodos){
  const agora = new Date();
  return periodos.some(([ini,fim]) => {
    const a = parseDateTime(ini), b = parseDateTime(fim);
    return agora >= a && agora <= b;
  });
}

/* ---------------- MONTAR LISTA (usa filtros corretamente) ---------------- */
function montarLista(){
  const filtroFunc = document.getElementById("funcSelect").value;
  const filtroMes = document.getElementById("mesSelect").value;
  const lista = document.getElementById("lista"); lista.innerHTML = "";

  folgas.forEach(pessoa => {
    if(filtroFunc !== "todos" && pessoa.nome !== filtroFunc) return;

    // filtra apenas per√≠odos do m√™s selecionado
    const mostrar = pessoa.periodos.filter(p => filtroMes === "todos" || p[0].startsWith(filtroMes));
    if(mostrar.length === 0) return;

    const div = document.createElement("div"); div.classList.add("pessoa");
    if(estaDeFolga(pessoa.periodos)) div.classList.add("em-folga");

    if(pessoa.editando){
      // edi√ß√£o mostra apenas per√≠odos filtrados ‚Äî usando √≠ndices locais (0..n-1)
      const nomeID = pessoa.nome.replace(/\s+/g,"_");
      div.innerHTML = `<div class="titulo">${pessoa.nome}</div>` +
        mostrar.map((p,i)=> {
          const ini = parseDateTime(p[0]), fim = parseDateTime(p[1]);
          return `<div style="background:#eee;padding:10px;margin-bottom:10px;border-radius:8px;">
            <b>Per√≠odo ${i+1}</b><br><br>
            In√≠cio:<br>
            <input type="date" id="iniData_${nomeID}_${i}" value="${formatDateInput(ini)}"><br>
            <input type="time" id="iniHora_${nomeID}_${i}" value="${formatTimeInput(ini)}"><br><br>
            Fim:<br>
            <input type="date" id="fimData_${nomeID}_${i}" value="${formatDateInput(fim)}"><br>
            <input type="time" id="fimHora_${nomeID}_${i}" value="${formatTimeInput(fim)}"><br><br>
            <button class="red" onclick="removerFolgaFiltrada('${pessoa.nome}',${i})">üóë Remover</button>
          </div>`;
        }).join("") +
        `<button class="primary" onclick="adicionarFolga('${pessoa.nome}')">‚ûï Adicionar</button>
         <button class="green" onclick="salvarEdicao('${pessoa.nome}')">Salvar</button>
         <button class="red" onclick="cancelarEdicao('${pessoa.nome}')">Cancelar</button>`;
    } else {
      div.innerHTML = `<div class="titulo">${pessoa.nome}</div>
        <button class="green" onclick="copiarFolgas('${pessoa.nome}')">üìã Copiar</button>
        <button class="orange" onclick="editar('${pessoa.nome}')">‚úè Editar</button>` +
        mostrar.map((p,i)=> {
          const ini = parseDateTime(p[0]), fim = parseDateTime(p[1]);
          return `<div class="folga-item">
            <div class="data">üóì ${ini.toLocaleDateString("pt-BR")} ‚Üí ${fim.toLocaleDateString("pt-BR")}</div>
            <div class="hora">‚è∞ Das ${ini.toLocaleTimeString("pt-BR",{hour:'2-digit',minute:'2-digit'})} √†s ${fim.toLocaleTimeString("pt-BR",{hour:'2-digit',minute:'2-digit'})}</div>
          </div>${i<mostrar.length-1?'<hr>':''}`;
        }).join("");
    }

    lista.appendChild(div);
  });
}

/* ---------- EDI√á√ÉO (trabalha com per√≠odos filtrados) ---------- */
function editar(nome){ folgas.find(f=>f.nome===nome).editando = true; montarLista(); }
function cancelarEdicao(nome){ folgas.find(f=>f.nome===nome).editando = false; montarLista(); }

function removerFolgaFiltrada(nome, idxFiltrado){
  const filtroMes = document.getElementById("mesSelect").value;
  const pessoa = folgas.find(f=>f.nome===nome);
  // encontrar per√≠odo real equivalente (primeira ocorr√™ncia igual)
  const filtrados = pessoa.periodos.filter(p=> p[0].startsWith(filtroMes));
  const periodo = filtrados[idxFiltrado];
  pessoa.periodos = pessoa.periodos.filter(p => !(p[0] === periodo[0] && p[1] === periodo[1]));
  montarLista();
}

function adicionarFolga(nome){
  const pessoa = folgas.find(f=>f.nome===nome);
  const lastEnd = parseDateTime(pessoa.periodos[pessoa.periodos.length-1][1]);
  let inicio;
  if(lastEnd.getDay()===1){ inicio = new Date(lastEnd); inicio.setDate(inicio.getDate()+1); inicio.setHours(7,0,0,0); }
  else { inicio = new Date(lastEnd.getTime() + 7*24*60*60*1000); if(inicio.getDay()===1){ inicio.setDate(inicio.getDate()+1); inicio.setHours(7,0,0,0); } }
  const fim = new Date(inicio.getTime() + 36*60*60*1000);
  pessoa.periodos.push([ formatDateTime(inicio), formatDateTime(fim) ]);
  // manter Rafael/Vanderlei sincronizados
  const r = folgas.find(x=>x.nome==="Rafael"), v = folgas.find(x=>x.nome==="Vanderlei");
  if(r && v) v.periodos = JSON.parse(JSON.stringify(r.periodos));
  montarLista();
}

/* salva apenas os per√≠odos vis√≠veis no m√™s filtrado (mantendo os demais) */
async function salvarEdicao(nome){
  const pessoa = folgas.find(f=>f.nome===nome);
  const nomeID = nome.replace(/\s+/g,"_");
  const filtroMes = document.getElementById("mesSelect").value;
  // coletar editados (√≠ndices locais)
  const filtrados = pessoa.periodos.filter(p => filtroMes === "todos" || p[0].startsWith(filtroMes));
  const novosFiltrados = [];
  for(let i=0;i<filtrados.length;i++){
    const di = document.getElementById(`iniData_${nomeID}_${i}`).value;
    const hi = document.getElementById(`iniHora_${nomeID}_${i}`).value;
    const df = document.getElementById(`fimData_${nomeID}_${i}`).value;
    const hf = document.getElementById(`fimHora_${nomeID}_${i}`).value;
    if(!di||!hi||!df||!hf){ alert("Preencha todos os campos."); return; }
    novosFiltrados.push([ `${di} ${hi}`, `${df} ${hf}` ]);
  }
  // reconstruir lista completa mantendo per√≠odos de outros meses
  const novos = [];
  pessoa.periodos.forEach(p => {
    if(!p[0].startsWith(filtroMes)) novos.push(p);
  });
  novos.push(...novosFiltrados);
  pessoa.periodos = novos.sort((a,b)=> parseDateTime(a[0]) - parseDateTime(b[0]));
  pessoa.editando = false;
  // manter Rafael/Vanderlei
  const r = folgas.find(x=>x.nome==="Rafael"), v = folgas.find(x=>x.nome==="Vanderlei");
  if(r && v) v.periodos = JSON.parse(JSON.stringify(r.periodos));
  montarLista();
  await salvarTodasNoBanco();
}

/* ---------------- SUPABASE: CARREGAR e SALVAR ---------------- */
async function carregarFolgasDoBanco(){
  try {
    const { data, error } = await supabaseClient.from('folgas').select('*').order('inicio',{ascending:true});
    if(error){ console.error(error); alert("Erro ao carregar da nuvem."); return false; }
    if(!data || data.length===0) return false;
    // reset local
    folgas.forEach(f=> f.periodos = []);
    data.forEach(row=>{
      const pessoa = folgas.find(p=>p.nome===row.funcionario);
      if(pessoa) pessoa.periodos.push([ row.inicio, row.fim ]);
      else folgas.push({ nome: row.funcionario, editando:false, periodos:[[row.inicio,row.fim]] });
    });
    // garantir Rafael/Vanderlei
    const r = folgas.find(x=>x.nome==="Rafael"), v = folgas.find(x=>x.nome==="Vanderlei");
    if(r && v) v.periodos = JSON.parse(JSON.stringify(r.periodos));
    // ordenar per√≠odos
    folgas.forEach(f=> f.periodos.sort((a,b)=> parseDateTime(a[0]) - parseDateTime(b[0])));
    popularFuncionarios(); gerarMesesNoSelect(); montarLista();
    return true;
  } catch(e){ console.error(e); alert("Erro ao carregar do Supabase."); return false; }
}

async function salvarTodasNoBanco(){
  try{
    // apagar tudo e inserir (aten√ß√£o: isso deleta e recria)
    await supabaseClient.from('folgas').delete().neq('id',0);
    const linhas = [];
    folgas.forEach(f=> {
      f.periodos.forEach(p=> linhas.push({ funcionario: f.nome, inicio: p[0], fim: p[1] }));
    });
    if(linhas.length){
      const { error } = await supabaseClient.from('folgas').insert(linhas);
      if(error){ console.error(error); alert("Erro ao salvar no banco."); return; }
    }
    alert("Salvo na nuvem!");
  } catch(e){ console.error(e); alert("Erro ao salvar na nuvem."); }
}

/* ---------------- LOGIN (Supabase Auth) ---------------- */
const loginModal = document.getElementById("loginModal");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
loginBtn.onclick = ()=> openLogin();
logoutBtn.onclick = async ()=>{
  await supabaseClient.auth.signOut();
  localStorage.removeItem("rememberMe");
  loginBtn.style.display = "inline-block"; logoutBtn.style.display="none";
  alert("Deslogado");
};

function openLogin(){ document.getElementById("loginMsg").textContent=""; loginModal.style.display="flex"; }
function closeLogin(){ loginModal.style.display="none"; }

async function doLogin(){
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPass").value;
  const remember = document.getElementById("rememberMe").checked;
  if(!email || !pass){ document.getElementById("loginMsg").textContent="Preencha email e senha."; return; }
  document.getElementById("loginMsg").textContent = "Entrando...";
  const res = await supabaseClient.auth.signInWithPassword({ email, password: pass });
  if(res.error){ document.getElementById("loginMsg").textContent = res.error.message; return; }
  // login ok
  if(remember) localStorage.setItem("rememberMe","1");
  loginModal.style.display="none";
  loginBtn.style.display="none"; logoutBtn.style.display="inline-block";
  alert("Logado com sucesso!");
}

/* tenta restaurar sess√£o */
(async function restoreSession(){
  // se usu√°rio pediu lembrar, Supabase tende a persistir sess√£o automaticamente; aqui s√≥ atualizamos UI
  const s = await supabaseClient.auth.getSession();
  if(s && s.data && s.data.session) { loginBtn.style.display="none"; logoutBtn.style.display="inline-block"; }
})();

/* ---------------- MODO ESCURO ---------------- */
const darkToggle = document.getElementById("darkToggle");
darkToggle.addEventListener("change", ()=> {
  if(darkToggle.checked){ document.documentElement.classList.add("dark"); localStorage.setItem("dark","1"); }
  else { document.documentElement.classList.remove("dark"); localStorage.removeItem("dark"); }
});
/* restaurar prefer√™ncia */
if(localStorage.getItem("dark")){ darkToggle.checked=true; document.documentElement.classList.add("dark"); }

/* ---------------- NOTIFICA√á√ïES LOCAIS (quando site aberto) ---------------- */
async function requestNotificationPermission(){ 
  if(!("Notification" in window)) return false;
  if(Notification.permission === "granted") return true;
  if(Notification.permission !== "denied"){
    const p = await Notification.requestPermission();
    return p === "granted";
  }
  return false;
}

/* agenda lembretes locais (rodam somente enquanto a aba estiver aberta) */
async function scheduleLocalReminders(){
  if(!await requestNotificationPermission()) return;
  // limpar timers simples (n√£o implementamos cancelamento aqui; √© uma demo)
  const now = new Date();
  folgas.forEach(p=>{
    p.periodos.forEach(pr=>{
      const ini = parseDateTime(pr[0]);
      const fim = parseDateTime(pr[1]);
      // notificar 12h antes de in√≠cio
      const antesIni = new Date(ini.getTime() - 12*60*60*1000);
      if(antesIni > now){
        setTimeout(()=> new Notification(`${p.nome} entra em folga`, { body: `Come√ßa em ${ini.toLocaleString("pt-BR")}` }), antesIni - now);
      }
      // notificar 12h antes de fim (quando volta)
      const antesFim = new Date(fim.getTime() - 12*60*60*1000);
      if(antesFim > now){
        setTimeout(()=> new Notification(`${p.nome} volta da folga`, { body: `Volta em ${fim.toLocaleString("pt-BR")}` }), antesFim - now);
      }
    });
  });
}

/* ---------------- UTIL: carregar autom√°tico ao abrir ---------------- */
async function initApp(){
  gerarMesesNoSelect();
  // tentar carregar do Supabase; se retornar false (vazio/erro), usa dados locais
  const ok = await carregarFolgasDoBanco();
  if(!ok){
    gerarFolgasAte2026(); // usa dados locais como fallback
    popularFuncionarios();
    montarLista();
  } else {
    popularFuncionarios();
  }
  // agendar lembretes locais
  scheduleLocalReminders().catch(()=>{});
}

/* ---------------- COPIAR / QUEM EST√Å ---------------- */
function copiarFolgas(nome){
  const f = folgas.find(x=>x.nome===nome);
  const filtroMes = document.getElementById("mesSelect").value;
  let lista = f.periodos;
  if(filtroMes !== "todos") lista = lista.filter(p=>p[0].startsWith(filtroMes));
  if(lista.length===0){ alert("Sem folgas no m√™s selecionado."); return; }
  let ref = lista[0][0].slice(5,7)+"/"+lista[0][0].slice(0,4);
  let texto = `Ol√° ${f.nome}! Aqui est√° sua escala de folgas para ${ref}:\n\n` + lista.map(p=>`- ${p[0]} at√© ${p[1]}`).join("\n");
  navigator.clipboard.writeText(texto).then(()=>alert("Copiado!")).catch(()=>alert("N√£o foi poss√≠vel copiar automaticamente."));
}
function mostrarFolgasAgora(){
  const em = folgas.filter(f=>estaDeFolga(f.periodos));
  if(em.length===0) alert("Ningu√©m est√° de folga agora.");
  else alert("Em folga:\n" + em.map(x=>x.nome).join("\n"));
}

/* ---------------- EVENTOS UI ---------------- */
document.getElementById("funcSelect").addEventListener("change", montarLista);
document.getElementById("mesSelect").addEventListener("change", montarLista);

/* ---------------- INICIAR ---------------- */
initApp();
</script>
</body>
</html>
